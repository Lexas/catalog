#!/bin/sh

set -e
set -u

cd "$OPENSHIFT_REPO_DIR"

pythondir="$OPENSHIFT_DEPENDENCIES_DIR/python"

if [ ! -d "$pythondir" ]
then
    # We can't use symlinks due to SELinux setup in Openshift
    # ...and there's a bug with --always-copy in the system virtualenv
    python2.7 "$OPENSHIFT_REPO_DIR/.openshift/virtualenv.py" \
        --extra-search-dir=/usr/lib/python2.7/site-packages/virtualenv_support \
        --always-copy "$pythondir"
fi

"$pythondir/bin/pip" install -r requirements_backend.txt

. "$OPENSHIFT_REDLAND_DIR/bin/activate-redland"

cd backend
"$pythondir/bin/python" setup.py install
