//- Catalog web - user public profile page
//- 
//- Copyright 2014 Commons Machinery http://commonsmachinery.se/
//- Distributed under an AGPL_v3 license, please see LICENSE in the top dir.

//- TODO: this page is hardcoded for now, as there's nothing
//- interestingly dynamic to do yet.

mixin defTerm(term, caption)
    if term != null
        span(class=caption.toLowerCase().replace(' ', '_'))
            dt #{caption}
            dd #{term}    

mixin userProfile(profile, showEmpty)
    img.gravatar(src=gravatarHashURL(profile.gravatar_hash, 237))
    dl
        - var displayName = user.alias || user.id
        +defTerm(showEmpty || displayName, 'User')
        +defTerm(showEmpty || profile.name, 'Name')
        +defTerm(showEmpty || profile.email, 'Email')
        +defTerm(showEmpty || profile.location, 'Location')
        +defTerm(showEmpty || profile.website, 'Website')
    if userId == user.id
        div 
            +defTerm(showEmpty || profile.gravatar_email, 'Gravatar email')
            a(href='#{userId}/sources') My stock sources
    if user._perms.write === true
        div.actions
            button.edit(data-action="edit-profile") Edit Profile

include includes/top
    div#userProfile
        +userProfile(user.profile)

    include includes/bottom

    script#editUserProfileTemplate(type="text/template")
        form
            fieldset#fields
                span
                    label(for="input-alias") User alias: 
                    input#input-alias(type="text")
                span
                    label(for="input-alias") Name: 
                    input#input-name(type="text")
                span
                    label(for="input-email") Email: 
                    input#input-email(type="email")
                span
                    label(for="location") Location: 
                    input#input-location(type="text")
                span
                    label(for="input-website") Website: 
                    input#input-website(type="url")
                span
                    label(for="input-gravatar_email") Gravatar email: 
                    input#input-gravatar_email(type="email")
            fieldset.actions
                button.save(data-action="save") Save
                button.cancel(data-action="cancel") Cancel

    script#userProfileTemplate(type="text/template")
        +userProfile(user.profile, true)

    script.bootstrapData(type='application/json')
        != bootstrapData({ "data": user })
